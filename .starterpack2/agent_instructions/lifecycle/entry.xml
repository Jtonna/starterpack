<lifecycle name="ENTRY">

  <summary>
    Routes incoming work to the correct lifecycle. Creates tickets if needed.
    Selects branching strategy. Every change must be tied to a beads ticket.
  </summary>

  <uses-behavior name="git-with-beads" />
  <uses-behavior name="scope-enforcement" />
  <uses-behavior name="human-gate" context="ENTRY/SPEC_FILE_APPROVAL" />
  <uses-behavior name="response-format" lifecycle="ENTRY" />

  <entry-points>

    <entry name="EXISTING_TICKET">
      A beads ticket already exists (the human says "work on KAN-29b" or the orchestrator picks one from "bd ready").
      <action>Run "bd show {id}" to read the ticket, then proceed to PLANNING.</action>
    </entry>

    <entry name="SPEC_FILE">
      The human points to a spec file or provides a large feature description
      that needs to be broken into multiple tickets before work can begin.
      <actions>
        <action>Read the spec file</action>
        <action>Create an epic ticket: bd create --type epic --title "..." --description "..."</action>
        <action>
          Decompose the spec into individual feature/task tickets.
          Do NOT create dependencies between children and the epic — the epic is a tracking
          container, not a blocker.
        </action>
        <action>
          Establish dependencies between child tickets where ordering matters:
          bd dep add {later-ticket} {earlier-ticket}
        </action>
        <action>HUMAN_GATE: Present the full ticket breakdown for approval (see human-gate behavior)</action>
        <action>Pick the first ready ticket (bd ready) and proceed to PLANNING</action>
      </actions>
    </entry>

    <entry name="AD_HOC_REQUEST">
      The human gives an instruction directly (e.g. "add a logout button").
      This is NOT a ticket yet.
      <actions>
        <action>Create a beads ticket: bd create --type feature|bug|task --title "..." --description "..."</action>
        <action>Confirm with the human: "Created {ticket-id}: {title}. Proceeding."</action>
        <action>Proceed to PLANNING with the new ticket</action>
      </actions>
      <rule>
        Never implement an ad-hoc request without a ticket. If the human insists on skipping,
        explain that every change must be tracked and push back respectfully.
      </rule>
    </entry>

  </entry-points>

  <branching-strategy-selection>
    The orchestrator determines the strategy here, using the rules from git-with-beads:
    - SPEC_FILE entry → FEATURE_BRANCHING (always)
    - EXISTING_TICKET with type "epic" → FEATURE_BRANCHING
    - EXISTING_TICKET with any other type → TRUNK_BASED
    - AD_HOC_REQUEST → TRUNK_BASED (unless planning reveals it should be an epic)
  </branching-strategy-selection>

</lifecycle>
